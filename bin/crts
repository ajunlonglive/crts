#!/bin/sh -eu

die() {
	echo "$@" >&2
	exit 1
}

build_dir=build
valgrind=""

export CRTS_ASSET_PATH="build/assets/obj:build/assets:assets/shaders:assets/cfg:assets/obj:assets"
export CRTS_LOG_LVL=3

while getopts "vb:" opt; do
	case "$opt" in
	v) valgrind=1;;
	b) build_dir="$OPTARG";;
	?) die "invalid arg";;
	esac
done
shift "$((OPTIND-1))"

case "$1" in
c|client) exe="$build_dir/client/client";;
s|server) exe="$build_dir/server/server";;
t|terragen) exe="$build_dir/terragen/terragen";;
p|snap) exe="$build_dir/util/snap";;
*) die "command $1 not found";;
esac

shift

if [ "$valgrind" ]; then
	exec valgrind "$exe" "$@"
else
	exec "$exe" "$@"
fi
