#!/bin/sh -eu

build=$1
app=crts.app
buildtype=release

rm -rf "$app"

if [ -d "$build" ]; then
	reconf="--reconfigure"
else
	reconf=""
fi

meson $reconf\
	--prefix="$PWD/$app" \
        --bindir=Contents/MacOS \
        -Dsubcmd-dir=Contents/MacOS \
	-Dbuild-tests=true \
	-Dopengl-ui=enabled \
	-Dncurses-ui=disabled \
	-Dbuild-macos-app=true \
	--buildtype="$buildtype" \
        $build

ninja -C "$build" test install

zip -r ${app}.zip $app
